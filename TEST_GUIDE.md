# 插件功能测试指南

## 问题诊断与修复

### 修复内容

**问题**: 插件安装后没有任何效果

**根本原因**:
1. `initPlugin()` 函数中缺少 `createExportButton()` 调用
2. 导出按钮在文件顶层被调用,此时 DOM 可能未加载完成
3. `cleanup()` 函数中未清理导出按钮

**修复方案**:
- ✅ 在 `initPlugin()` 中添加 `createExportButton()` 调用
- ✅ 在 `cleanup()` 中添加导出按钮的移除逻辑
- ✅ 删除文件末尾的冗余代码
- ✅ 在 `createExportButton()` 中添加防重复创建检查
- ✅ 重新构建插件

---

## 安装步骤

### 1. 加载插件

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 右上角启用「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择 `build/chrome-mv3-prod/` 目录
6. 确认插件已加载成功

### 2. 检查插件状态

在扩展管理页面确认:
- ✅ 插件名称: X(Twitter) 互关检测助手
- ✅ 版本: 1.0.0
- ✅ 状态: 已启用
- ✅ 权限: storage, https://x.com/*

---

## 功能测试清单

### 测试 1: Popup 控制面板

**步骤**:
1. 点击浏览器工具栏中的插件图标
2. 观察弹出窗口

**预期效果**:
- ✅ 显示紫色渐变背景的弹出窗口
- ✅ 标题: "X(Twitter) 互关检测助手"
- ✅ 版本信息: "v1.0.0"
- ✅ 启用/禁用开关正常显示
- ✅ 功能说明和使用方法清晰可见
- ✅ GitHub 链接可点击

**测试开关**:
1. 点击开关,切换到"禁用"状态
2. 刷新页面后再次打开 Popup
3. 确认开关保持"禁用"状态(状态持久化)

---

### 测试 2: 页面检测功能

**前提条件**:
- 确保插件已启用(Popup 中的开关为"开启")

**步骤**:
1. 访问你的 X(Twitter) 关注列表页面:
   ```
   https://x.com/你的用户名/following
   ```
2. 等待页面加载完成
3. 观察页面变化

**预期效果**:

#### 统计栏显示 ✅
- 页面顶部出现蓝色渐变统计栏
- 显示内容格式: `总关注：XXX | 未互关：YYY`
- 统计栏固定在页面顶部,滚动时保持可见
- 页面内容向下偏移,不被统计栏遮挡

#### 未互关用户标记 ✅
- 未互关的用户条目显示浅红色背景 (rgba(255, 68, 68, 0.15))
- 用户名后显示红色文字 "（未关注你）"
- 已互关的用户保持原样,无特殊标记

#### 实时更新 ✅
- 向下滚动页面,加载更多用户
- 新加载的用户自动检测并标记
- 统计数字实时更新

---

### 测试 3: 导出功能

**步骤**:
1. 在关注列表页面,找到右下角的黑色浮动按钮
2. 确认按钮文字: "导出关注列表为 CSV"
3. 点击按钮

**预期效果**:

#### 自动滚动阶段 ✅
- 按钮文字变为 "滚动中...点击停止"
- 进度文字显示: `已加载：XXX 人（滚动中...）`
- 页面自动向下滚动
- 滚动间隔为 3-6 秒随机延迟(模拟真人行为)
- 统计数字持续更新

#### 停止条件 ✅
- **自动停止**: 连续 15 秒无新用户加载时
- **手动停止**: 点击按钮手动停止

#### 导出完成 ✅
- 自动下载 CSV 文件
- 文件名格式: `我的关注列表_YYYYMMDD_HHMMSS.csv`
- 按钮恢复为 "导出关注列表为 CSV"
- 进度文字显示已加载的总人数

#### CSV 文件验证 ✅

用 Excel 或记事本打开 CSV 文件,检查:

**文件格式**:
```csv
显示名称,用户名,是否互关,是否蓝V,主页链接
张三,zhangsan,是,否,https://x.com/zhangsan
李四,lisi,否,是,https://x.com/lisi
```

**字段说明**:
- 显示名称: 用户的显示名称
- 用户名: @后面的用户名
- 是否互关: "是" 或 "否"
- 是否蓝V: "是" 或 "否"
- 主页链接: 用户主页完整 URL

**编码检查**:
- 中文字符显示正常(UTF-8 BOM 编码)
- 无乱码

---

### 测试 4: 开关功能

**步骤**:
1. 在关注列表页面,点击插件图标打开 Popup
2. 关闭「启用插件功能」开关
3. 观察页面变化
4. 重新启用开关
5. 刷新页面

**预期效果**:

#### 禁用后 ✅
- 统计栏消失
- 红色标记和提示文字消失
- 导出按钮消失
- 已标记的用户恢复原样

#### 启用后 ✅
- 统计栏重新出现
- 红色标记和提示文字重新显示
- 导出按钮重新出现
- 统计数字正确

#### 刷新后 ✅
- 开关状态保持
- 如果是禁用状态,刷新后仍然禁用
- 如果是启用状态,刷新后功能正常工作

---

## 常见问题排查

### 问题 1: 插件图标不显示

**解决方法**:
1. 检查是否正确选择了 `build/chrome-mv3-prod/` 目录
2. 查看扩展管理页面是否有错误提示
3. 重新加载插件:
   - 点击扩展卡片上的刷新图标 🔄
   - 或先移除插件,再重新加载

### 问题 2: 统计栏不显示

**检查清单**:
- [ ] 插件是否启用(Popup 中的开关)
- [ ] 是否在正确的页面 (`https://x.com/*/following`)
- [ ] 浏览器控制台是否有错误(按 F12 查看)
- [ ] 尝试刷新页面

**调试步骤**:
1. 按 F12 打开开发者工具
2. 切换到 Console 标签
3. 查找错误信息
4. 如果看到权限错误,检查 manifest.json 权限配置

### 问题 3: 导出按钮不显示

**可能原因**:
- 插件未启用
- 不在关注列表页面
- DOM 加载未完成

**解决方法**:
1. 确认 Popup 中开关为"开启"
2. 刷新页面
3. 检查浏览器控制台错误
4. 尝试重新加载插件

### 问题 4: CSV 导出无反应

**检查项**:
- [ ] 浏览器是否阻止了下载(查看地址栏右侧)
- [ ] 是否有用户加载出来
- [ ] 滚动是否正常工作

**解决方法**:
1. 允许浏览器下载文件
2. 确保页面有用户条目
3. 手动滚动一下页面,确认能加载更多用户
4. 查看控制台是否有错误

### 问题 5: 标记不准确

**可能原因**:
- X(Twitter) 页面结构变化
- 网络加载问题

**验证方法**:
1. 手动检查几个用户的互关状态
2. 对比插件标记是否正确
3. 如果不准确,可能需要更新选择器

---

## 性能验证

### 内存占用
打开任务管理器(Shift + Esc),检查插件内存占用:
- **预期**: < 50MB
- **如果超过**: 可能有内存泄漏,请反馈

### CPU 使用
在空闲状态(不滚动)时:
- **预期**: < 5%
- **如果持续高**: 可能 MutationObserver 配置有问题

### 页面加载影响
- 打开关注列表页面的时间应该与未安装插件时相差不大
- **预期**: 增加 < 100ms

---

## 浏览器兼容性

### 已测试
- ✅ Chrome 120+
- ✅ Edge 120+

### 理论兼容
- Brave
- Opera
- 其他基于 Chromium 的浏览器

---

## 调试技巧

### 查看内容脚本日志
1. 访问 `https://x.com/你的用户名/following`
2. 按 F12 打开开发者工具
3. 切换到 Console 标签
4. 查看是否有来自插件的日志

### 查看 Popup 日志
1. 右键点击插件图标
2. 选择「检查弹出内容」
3. 在新窗口中查看 Console

### 重新加载插件
修改代码后:
1. 访问 `chrome://extensions/`
2. 找到「X(Twitter) 互关检测助手」
3. 点击刷新图标 🔄
4. 刷新测试页面

---

## 测试完成标准

所有以下项目都打勾,才算测试通过:

### 基础功能
- [ ] Popup 正常显示
- [ ] 开关控件工作正常
- [ ] 状态持久化正常

### 检测功能
- [ ] 统计栏正常显示
- [ ] 未互关用户正确标记
- [ ] 滚动时实时更新
- [ ] 统计数字准确

### 导出功能
- [ ] 导出按钮正常显示
- [ ] 自动滚动工作正常
- [ ] 进度信息准确
- [ ] CSV 文件正确下载
- [ ] CSV 内容格式正确

### 性能指标
- [ ] 内存占用 < 50MB
- [ ] CPU 使用 < 5% (空闲)
- [ ] 页面加载无明显卡顿

---

## 测试报告模板

如果遇到问题,请按以下格式反馈:

```
## 问题描述
[简要描述问题]

## 重现步骤
1. [步骤 1]
2. [步骤 2]
3. ...

## 预期行为
[应该发生什么]

## 实际行为
[实际发生了什么]

## 环境信息
- 浏览器: [Chrome/Edge/其他]
- 版本: [浏览器版本]
- 操作系统: [Windows/macOS/Linux]
- 插件版本: 1.0.0

## 控制台错误
[如果有,请粘贴控制台错误信息]

## 截图
[如果可能,请提供截图]
```

---

## 成功测试后的下一步

如果所有测试通过:

1. **日常使用**: 开始在实际场景中使用插件
2. **反馈意见**: 记录使用体验和改进建议
3. **分享**: 向其他人推荐这个工具
4. **贡献**: 如果发现 bug 或有新想法,提交 Issue 或 PR

---

**测试愉快! 如有任何问题,请查看 [README.md](README.md) 或提交 [GitHub Issue](https://github.com/yaolifeng0629/x-mutual-follow-detector/issues)**
